---
import { cases } from "@/lib/data";
---

<section class="py-24 bg-surface-300">
  <div class="container mx-auto px-6">
    <div class="text-center max-w-3xl mx-auto mb-16 space-y-4">
      <h2 class="text-primary font-serif italic text-2xl">Resultados Reales</h2>
      <h3 class="text-4xl md:text-5xl font-light text-ink-base">
        Transformaciones que <span class="font-bold">Inspiran</span>
      </h3>
      <p class="text-ink-muted text-lg">
        La ciencia y la experiencia del Dr. Ballesteros aplicadas para revelar
        la mejor versión de tu piel.
      </p>
    </div>

    <div class="flex flex-col gap-20">
      {
        cases.map((item, index) => (
          <div
            class={`flex flex-col md:flex-row items-center gap-12 ${index % 2 !== 0 ? "md:flex-row-reverse" : ""}`}
          >
            <div class="flex-1 w-full max-w-2xl">
              <div class="relative aspect-video rounded-3xl overflow-hidden shadow-2xl border-4 border-white group cursor-ew-resize">
                <img
                  src={item.after}
                  alt="Después"
                  class="absolute inset-0 w-full h-full object-cover"
                />

                <div
                  class="absolute inset-0 w-full h-full overflow-hidden slider-before"
                  style="clip-path: inset(0 50% 0 0);"
                >
                  <img
                    src={item.before}
                    alt="Antes"
                    class="absolute inset-0 w-full h-full object-cover"
                  />
                </div>

                <div class="absolute inset-y-0 left-1/2 w-1 bg-white shadow-[0_0_10px_rgba(0,0,0,0.3)] z-10 slider-handle">
                  <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center">
                    <svg
                      class="w-6 h-6 text-primary"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M8 7l-4 4m0 0l4 4m-4-4h16m0 0l-4-4m4 4l-4 4"
                      />
                    </svg>
                  </div>
                </div>

                <span class="absolute bottom-4 left-4 bg-ink-base/60 backdrop-blur-md text-white text-[10px] font-bold px-3 py-1 rounded-full z-20">
                  ANTES
                </span>
                <span class="absolute bottom-4 right-4 bg-primary/80 backdrop-blur-md text-white text-[10px] font-bold px-3 py-1 rounded-full z-20">
                  DESPUÉS
                </span>
              </div>
            </div>

            <div class="flex-1 space-y-6 text-center md:text-left">
              <span class="inline-block px-4 py-2 rounded-full bg-white border border-base-strong text-primary text-xs font-bold uppercase tracking-widest">
                {item.tag}
              </span>
              <h4 class="text-3xl font-bold text-ink-base">{item.title}</h4>
              <p class="text-ink-muted text-lg leading-relaxed italic">
                "{item.description}"
              </p>
              <div class="pt-4">
                <button class="bg-primary/10 hover:bg-primary text-primary hover:text-white px-8 py-3 rounded-xl font-bold transition-all duration-300">
                  Ver tratamiento completo
                </button>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<script>
  // Lógica para los Sliders de Comparación
  const containers = document.querySelectorAll(".group.cursor-ew-resize");

  containers.forEach((container) => {
    const beforeImage = container.querySelector(
      ".slider-before",
    ) as HTMLElement;
    const handle = container.querySelector(".slider-handle") as HTMLElement;

    const moveSlider = (e: MouseEvent | TouchEvent) => {
      const rect = container.getBoundingClientRect();
      const x =
        "touches" in e
          ? e.touches[0].clientX - rect.left
          : (e as MouseEvent).clientX - rect.left;

      let position = (x / rect.width) * 100;
      if (position < 0) position = 0;
      if (position > 100) position = 100;

      beforeImage.style.clipPath = `inset(0 ${100 - position}% 0 0)`;
      handle.style.left = `${position}%`;
    };

    container.addEventListener("mousemove", (e) => moveSlider(e as MouseEvent));
    container.addEventListener("touchmove", (e) => moveSlider(e as TouchEvent));
  });
</script>
