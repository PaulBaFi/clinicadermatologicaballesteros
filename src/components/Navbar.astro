---
const phone = "+51 998-123-312";
const { pathname } = Astro.url;

const links = [
  { label: "Inicio", link: "/" },
  { label: "Tratamientos", link: "/tratamientos" },
  { label: "Nosotros", link: "/nosotros" },
  { label: "Contacto", link: "/contacto" },
];

const isActive = (path: string) => {
  if (path === "/" && pathname === "/") return true;
  if (path !== "/" && pathname.startsWith(path)) return true;
  return false;
};
---

<header class="fixed top-0 left-0 w-full z-50 px-6 py-4">
  <nav class="container mx-auto relative">
    <div
      class="bg-white/80 backdrop-blur-md border border-base-light rounded-2xl px-6 py-3 flex items-center justify-between shadow-sm relative z-60"
    >
      <a href="/" class="flex items-center gap-2 group">
        <div class="w-10 h-10 transition-transform group-hover:rotate-12">
          <img src="/favicon.png" alt="Logo Ballesteros" />
        </div>
        <div class="flex flex-col">
          <span class="text-ink-base font-medium leading-snug text-lg"
            >Ballesteros</span
          >
          <span
            class="text-logo font-medium text-[10px] uppercase tracking-[0.2em] leading-snug font-serif"
            >Clínica dermatológica</span
          >
        </div>
      </a>

      <ul class="hidden md:flex items-center gap-8">
        {
          links.map(({ label, link }) => {
            const active = isActive(link);
            return (
              <li>
                <a
                  href={link}
                  class:list={[
                    "text-sm font-semibold transition-all relative py-1",
                    active
                      ? "text-primary"
                      : "text-ink-muted hover:text-primary",
                  ]}
                >
                  {label}
                  {active && (
                    <span class="absolute -bottom-1 left-0 w-full h-0.5 bg-primary rounded-full animate-in fade-in zoom-in duration-300" />
                  )}
                </a>
              </li>
            );
          })
        }
      </ul>

      <div class="flex items-center gap-4">
        <a
          href={`tel:${phone.replace(/\D/g, "")}`}
          class="hidden lg:flex items-center gap-2 text-ink-muted hover:text-primary transition-colors"
        >
          <div class="p-2 bg-surface-200 rounded-full text-primary">
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
              ></path></svg
            >
          </div>
          <span class="text-xs font-bold font-mono">{phone}</span>
        </a>

        <button
          class="hidden sm:block bg-primary hover:bg-primary-dark text-ink-on-primary px-6 py-2.5 rounded-xl leading-snug font-medium text-sm shadow-lg shadow-primary/20 transition-all transform active:scale-95 cursor-pointer"
        >
          Agendar cita
        </button>

        <button
          id="menu-toggle"
          class="md:hidden text-ink-base p-1 cursor-pointer z-70"
          aria-label="Abrir menú"
        >
          <svg
            id="menu-icon"
            class="w-6 h-6 transition-transform duration-300"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16"></path>
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 12h16"></path>
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M7 18h13"></path>
          </svg>
        </button>
      </div>
    </div>

    <div
      id="mobile-menu"
      class="fixed inset-0 bg-surface-100/95 backdrop-blur-xl z-55 flex flex-col items-center justify-center translate-x-full transition-transform duration-500 md:hidden"
    >
      <ul class="flex flex-col items-center gap-8 text-center">
        {
          links.map(({ label, link }) => (
            <li>
              <a
                href={link}
                class:list={[
                  "text-3xl font-light transition-colors",
                  isActive(link)
                    ? "text-primary font-medium"
                    : "text-ink-base hover:text-primary",
                ]}
              >
                {label}
              </a>
            </li>
          ))
        }
      </ul>

      <div class="mt-12 flex flex-col items-center gap-6">
        <a
          href={`tel:${phone.replace(/\D/g, "")}`}
          class="text-primary font-mono font-bold text-lg">{phone}</a
        >
        <button
          class="bg-primary text-ink-on-primary px-10 py-4 rounded-full font-bold shadow-xl shadow-primary/20"
        >
          Agendar Cita
        </button>
      </div>
    </div>
  </nav>
</header>

<script>
  const toggleBtn = document.getElementById("menu-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const menuIcon = document.getElementById("menu-icon") as HTMLElement;

  const originalIcon = `
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16"></path>
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16"></path>
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 18h13"></path>
  `;

  const closeIcon = `
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
  `;

  toggleBtn?.addEventListener("click", () => {
    const isOpened = mobileMenu?.classList.toggle("translate-x-0");
    mobileMenu?.classList.toggle("translate-x-full");

    document.body.style.overflow = isOpened ? "hidden" : "";

    if (menuIcon) {
      menuIcon.innerHTML = isOpened ? closeIcon : originalIcon;
    }
  });
</script>

<style>
  /* Evitar saltos en mobile si hay scrollbar */
  #mobile-menu {
    height: 100dvh;
  }
</style>
